<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF--8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Profile | TasteMate</title>
    <style>
      /* Hide scrollbar utility for modal open */
      body.modal-open {
        overflow: hidden !important;
        position: relative;
      }
      body.modal-open::-webkit-scrollbar {
        display: none;
      }
      body.modal-open {
        -ms-overflow-style: none;  /* IE and Edge */
        scrollbar-width: none;     /* Firefox */
      }
      /* --- Base and Shared Styles --- */
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        font-family: 'Segoe UI', sans-serif;
      }

      html {
        scroll-behavior: smooth;
      }

      body {
        background: #fff8ee;
        color: #333;
      }
      
      img {
        max-width: 100%;
        height: auto;
        display: block;
      }

      @keyframes fadeUp {
        0% {
          transform: translateY(40px);
          opacity: 0;
        }
        100% {
          transform: translateY(0px);
          opacity: 1;
        }
      }

      /* --- Header and Navigation --- */
      header {
        display: flex;
        justify-content: center;
        width: 100%;
        position: relative;
        /* padding-top: 1rem; */
        height: 80px;
        margin-bottom: 2rem;
      }

      header nav {
        display: flex;
        align-items: center;
        justify-content: space-between;
        width: 95%;
        max-width: 1400px;
        border-radius: 30px;
        padding: 0.5rem 2rem;
        backdrop-filter: blur(25px) saturate(200%);
        background: rgba(255, 255, 255, 0.37);
        box-shadow: 0 4px 24px 0 rgba(255, 217, 0, 0.1);
        gap: 20px;
        position: fixed;
        /* top: 1rem; */
        z-index: 1000;
        transition: top 0.3s, opacity 0.3s;
        animation: fadeUp 0.7s cubic-bezier(0.68, -0.55, 0.27, 1.55) forwards;
        opacity: 0;
      }
      nav.navbar-hidden {
        top: -100px;
        opacity: 0;
      }
      header nav #navlogo {
        display: flex;
        align-items: center;
        gap: 12px;
      }
      header nav #navlogo img {
        width: 54px;
        filter: drop-shadow(0 2px 8px #ffd90055);
        transition: transform 0.2s;
      }
      header nav #navlogo img:hover {
        transform: scale(1.08) rotate(-6deg);
      }
      header nav .nav-links {
        display: flex;
        align-items: center;
        list-style: none;
        gap: 28px;
        padding: 0;
      }
      header nav .nav-links a {
       text-decoration: none;
            display: flex;
            align-items: center;
            gap: 7px;
            padding: 0.5rem 1.1rem;
            border-radius: 12px;
            font-size: 1.1rem;
            color: #333;
            font-weight: 500;
            transition: background 0.2s, color 0.2s, box-shadow 0.2s;
            box-shadow: 0 2px 8px 0 rgba(255, 217, 0, 0.04);
      }
      header nav .nav-links a img {
        width: 28px;
      }
      header nav .nav-links a span {
        font-size: 1.1rem;
        color: #333;
        font-weight: 600;
        letter-spacing: 0.5px;
      }
      header nav .nav-links a:hover,
      header nav .nav-links a.active {
        background: #ffb300;
        box-shadow: 0 4px 16px 0 rgba(255, 217, 0, 0.13);
      }
      header nav .nav-links a:hover span,
      header nav .nav-links a.active span {
        color: #fff;
      }
      header nav .nav-search-container {
        display: flex;
        align-items: center;
        gap: 10px;
        position: relative;
        margin: 0 18px;
        background: #fffbe6;
        border-radius: 12px;
        box-shadow: 0 2px 8px 0 rgba(255, 217, 0, 0.08);
        padding: 0.2rem 0.7rem 0.2rem 2.2rem;
        transition: box-shadow 0.2s;
      }
      header nav .nav-search-container .search-icon {
        width: 20px;
        position: absolute;
        left: 10px;
        top: 50%;
        transform: translateY(-50%);
        opacity: 0.7;
      }
      header nav .nav-search-container input {
        height: 38px;
        border-radius: 10px;
        border: none;
        outline: none;
        background: transparent;
        font-size: 1rem;
        color: #444;
        width: 160px;
        padding-left: 0.5rem;
        transition: width 0.3s;
      }
      header nav .nav-search-container input:focus {
        width: 240px;
        background: #fffde4;
      }
      #searchResults {
        position: absolute;
        top: 48px;
        left: 0;
        width: 100%;
        background: #fffbe6;
        border-radius: 10px;
        box-shadow: 0 2px 8px #ffd90033;
        z-index: 1001;
        display: none;
        text-align: left;
      }
      header nav .user-profile-link a {
        background: none;
        box-shadow: none;
        padding: 0.2rem;
        border-radius: 50%;
      }
       /* header nav .user-profile-link a.active {
        background: #ffb300;
      } */
      header nav .user-profile-link a img {
        width: 36px;
        border-radius: 50%;
        border: 2px solid #ffd90055;
        transition: box-shadow 0.2s;
      }
      header nav .user-profile-link a img:hover {
        box-shadow: 0 2px 12px 0 #ffd90055;
      }
      .hamburger-menu {
        display: none;
        cursor: pointer;
        z-index: 101;
      }
      .hamburger-menu div {
        width: 25px;
        height: 3px;
        background-color: #333;
        margin: 5px 0;
        transition: all 0.3s;
      }
      
      main {
        padding: 20px;
        max-width: 1400px;
        margin: 0 auto;
      }

      /* Profile Header */
      .profile-header {
        background: #fff;
        padding: 20px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        flex-wrap: wrap;
        gap: 20px;
        margin-bottom: 20px;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
      }

      .profile-info {
        display: flex;
        align-items: center;
        gap: 20px;
        flex-wrap: wrap;
      }
      #profileName{
        font-size: clamp(1.5rem, 3vw, 2rem);
        text-transform: capitalize;
      }
      .profile-avatar {
        background: #f7c28b;
        width: 120px;
        height: 120px;
        border-radius: 50%;
        font-size: 20px;
        font-weight: bold;
        display: flex;
        justify-content: center;
        align-items: center;
        color: #fff;
        background-size: cover;
        background-position: center;
        flex-shrink: 0;
      }

      .badge {
        display: inline-block;
        background: #ffa94d;
        color: #fff;
        font-size: 12px;
        padding: 4px 8px;
        border-radius: 6px;
        margin-top: 6px;
      }

      .points-bar {
        margin-top: 8px;
        background: #f1f1f1;
        border-radius: 10px;
        height: 8px;
        width: 250px;
        overflow: hidden;
      }

      .points-fill {
        background: #ff8c00;
        width: 75%;
        height: 100%;
        border-radius: 10px;
      }

      /* Stats Section */
      .stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
        margin-bottom: 20px;
      }

      .stat-box {
        background: white;
        padding: 15px;
        text-align: center;
        border-radius: 12px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.06);
      }

      .stat-box h2 {
        color: #ff6b00;
        font-size: 2rem;
      }
      .stat-box p {
        font-size: 0.9rem;
        color: #555;
      }

      /* Tabs */
      .tabs {
        display: flex;
        justify-content: center;
        margin-bottom: 20px;
        flex-wrap: wrap;
        gap: 10px;
      }

      .tab {
        padding: 10px 20px;
        cursor: pointer;
        background: #eee;
        border-radius: 8px;
        margin: 0 5px;
        transition: background 0.3s;
      }

      .tab:hover {
        background: #ddd;
      }

      .tab.active {
        background: #fff;
        font-weight: bold;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }

      /* Tab Content */
      .tab-content {
        background: white;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
      }

      /* Recipes */
      .recipe-cards {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
        gap: 15px;
        margin-top: 10px;
      }

      .recipe-card {
        background: #fdfdfd;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 1px 5px rgba(0, 0, 0, 0.1);
        transition: transform 0.2s ease;
      }

      .recipe-card:hover {
        transform: translateY(-4px);
      }

      .recipe-card img {
        width: 100%;
        height: 140px;
        object-fit: cover;
      }
      .recipe-card .recipe-info{
        padding: 10px;
      }
      .recipe-card h4 {
        font-size: 1.1rem;
        margin-bottom: 5px;
      }
      .recipe-card p {
        font-size: 0.8rem;
        color: #666;
      }

      /* Activity */
      .activity-log div {
        padding: 10px 0;
        border-bottom: 1px solid #eee;
      }

      /* No Favorites */
      .no-fav {
        text-align: center;
        padding: 30px;
      }

      .no-fav button {
        background: #ff6b00;
        border: none;
        padding: 10px 20px;
        border-radius: 8px;
        color: white;
        font-weight: bold;
        cursor: pointer;
        margin-top: 10px;
      }

      button {
        background: #ff6b00;
        border: none;
        padding: 10px 16px;
        border-radius: 8px;
        color: white;
        font-weight: 600;
        cursor: pointer;
        transition: 0.3s ease;
      }

      button:hover {
        background: #ff8000;
      }
      
      /* --- Edit Profile Modal --- */
      .modal-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 1050;
        backdrop-filter: blur(8px);
        background: rgba(0, 0, 0, 0.5);
        align-items: center;
        justify-content: center;
      }
      .modal-overlay.is-open {
        display: flex;
      }
      .edit-container {
        max-width: 500px;
        width: 90%;
        background: white;
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        /* Default: no scroll, but allow for responsive override */
      }

      @media (max-width: 600px) {
        .edit-container {
          max-height: 80vh;
          overflow-y: auto;
        }
      }
      .edit-container h2 {
        margin-bottom: 20px;
        color: #ff6b00;
      }
      .edit-container label {
        display: block;
        font-weight: bold;
        margin: 10px 0 5px;
      }
      .edit-container input[type="text"],
      .edit-container input[type="date"],
      .edit-container textarea {
        width: 100%;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 8px;
        margin-bottom: 10px;
      }
      .edit-container button.save {
        background: #28a745;
      }
      .edit-container button.cancel {
        background:#ccc;
        color:black;
        margin-left:10px;
      }


      /* --- Responsive Design --- */
      @media (max-width: 991px) {
        .hamburger-menu {
          display: block;
        }
        header nav {
            width: 90%;
            padding: 0.5rem 1.5rem;
        }
        header nav .nav-links {
          display: none;
          position: absolute;
          top: 70px;
          left: 0;
          width: 100%;
          flex-direction: column;
          background: rgba(240, 240, 240, 0.98);
          backdrop-filter: blur(10px);
          padding: 1rem 0;
          border-radius: 0 0 20px 20px;
          box-shadow: 0 8px 16px rgba(0,0,0,0.1);
        }
        header nav .nav-links.active {
          display: flex;
        }
        header nav .nav-links li {
          width: 90%;
          text-align: center;
        }
        header nav .nav-search-container {
            order: -1;
        }
        header nav .nav-links a,
        header nav .nav-search-container {
          margin: 0.5rem auto;
          width: 90%;
          justify-content: center;
        }
        header nav .nav-search-container input:focus {
          width: 100%;
        }
      }

       @media (max-width: 768px) {
         .profile-header {
           text-align: center;
           justify-content: center;
         }
         .profile-info {
           justify-content: center;
           text-align: center;
         }
       }
       @media (max-width: 480px) {
        header nav { padding: 0.5rem 1rem; }
        header nav #navlogo img { width: 45px; }
        .stats {
          grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        }
      }
    </style>
  </head>
  <body>
    <header>
      <nav>
        <div id="navlogo">
          <a href="index.html"><img src="./assets/recipe-book.png" alt="Logo"/></a>
        </div>
        <ul class="nav-links">
          <li>
            <a href="index.html">
              <img src="./assets/cooking.png" alt="Home" />
              <span>Home</span>
            </a>
          </li>
          <li>
            <a href="Recipes.html">
              <img src="./assets/book.png" alt="Recipes" />
              <span>Recipes</span>
            </a>
          </li>
          <li class="nav-search-container">
            <img src="./assets/search.png" alt="Search" class="search-icon" />
            <input type="text" id="homeSearchInput" placeholder="Search recipes..."/>
            <div id="searchResults"></div>
          </li>
          <li>
            <a href="MealPlanner.html">
              <img src="./assets/diary.png" alt="Meal Planner" />
              <span>MealPlanner</span>
            </a>
          </li>
          <li>
            <a href="ShoppingList.html">
              <img src="./assets/shopping-cart.png" alt="Shopping List" />
              <span>Shopping</span>
            </a>
          </li>
        </ul>
        <div class="user-profile-link">
          <a href="Profile.html" class="active">
            <img src="./assets/user.png" alt="Profile" />
          </a>
        </div>
        <div class="hamburger-menu">
          <div></div>
          <div></div>
          <div></div>
        </div>
      </nav>
    </header>

    <main>
        <div class="profile-header">
        <div class="profile-info">
            <div class="profile-avatar" id="avatarBox">AJ</div>
            <div>
            <h3 id="profileName">Alex Johnson</h3>
            <p>
                <span id="locationText">San Francisco, CA</span> • Joined
                <span id="joinedText">2024-01-15</span>
            </p>
            <p id="bioText">
        Food enthusiast and home cook who loves experimenting with flavors from around the world.
      </p>
      <button id="bioToggleBtn" style="display:none;margin:4px 0 0 0;padding:2px 12px;font-size:0.95em;border-radius:8px;background:#fffbe6;color:#ff6b00;border:1px solid #ffe0b2;cursor:pointer;transition:background 0.2s;">Show more</button>
      <style>
        #bioText {
          max-height: 60px;
          overflow: hidden;
          transition: max-height 0.5s cubic-bezier(.68,-0.55,.27,1.55);
          position: relative;
          display: block;
        }
        #bioText.expanded {
          max-height: 400px;
        }
        #bioToggleBtn {
          transition: background 0.2s, color 0.2s;
        }
        #bioToggleBtn:hover {
          background: #ffb300;
          color: #fff;
        }
      </style>
            <span class="badge">Seasoned Cook · 2350 pts</span>
            <div class="points-bar"><div class="points-fill"></div></div>
            <small>650 points to next level</small>
            </div>
        </div>
        <button id="editProfileBtn">Edit Profile</button>
        </div>

        <div class="stats">
            <div class="stat-box" data-target="12"><h2 class="stat-anim">0</h2><p>Recipes Created</p></div>
            <div class="stat-box" data-target="47"><h2 class="stat-anim">0</h2><p>Recipes Cooked</p></div>
            <div class="stat-box" data-target="23"><h2 class="stat-anim">0</h2><p>Favorites</p></div>
            <div class="stat-box" data-target="8"><h2 class="stat-anim">0</h2><p>Meal Plans</p></div>
            <div class="stat-box" data-target="89"><h2 class="stat-anim">0</h2><p>Total Ratings</p></div>
            <div class="stat-box" data-target="4.6" data-decimal="true"><h2 class="stat-anim">0</h2><p>Avg Rating</p></div>
      <style>
        .stat-box {
          opacity: 0;
          transform: translateY(30px);
          animation: statFadeIn 0.7s cubic-bezier(0.68,-0.55,0.27,1.55) forwards;
        }
        .stat-box:nth-child(1) { animation-delay: 0.1s; }
        .stat-box:nth-child(2) { animation-delay: 0.2s; }
        .stat-box:nth-child(3) { animation-delay: 0.3s; }
        .stat-box:nth-child(4) { animation-delay: 0.4s; }
        .stat-box:nth-child(5) { animation-delay: 0.5s; }
        .stat-box:nth-child(6) { animation-delay: 0.6s; }
        @keyframes statFadeIn {
          to {
            opacity: 1;
            transform: none;
          }
        }
      </style>
      <script>
      // Animated stats counter
      document.addEventListener("DOMContentLoaded", function() {
        function animateStat(el, target, isDecimal) {
          let start = 0;
          let end = parseFloat(target);
          let duration = 1200;
          let startTime = null;
          function step(ts) {
            if (!startTime) startTime = ts;
            let progress = Math.min((ts - startTime) / duration, 1);
            let value = isDecimal ? (start + (end - start) * progress).toFixed(1) : Math.floor(start + (end - start) * progress);
            el.textContent = value;
            if (progress < 1) requestAnimationFrame(step);
            else el.textContent = isDecimal ? end.toFixed(1) : end;
          }
          requestAnimationFrame(step);
        }
        document.querySelectorAll('.stat-box').forEach(box => {
          const h2 = box.querySelector('.stat-anim');
          const target = box.getAttribute('data-target');
          const isDecimal = box.getAttribute('data-decimal') === 'true';
          animateStat(h2, target, isDecimal);
        });
      });
      </script>
        </div>

        <div class="tabs">
            <div class="tab active" onclick="showTab('recipes', event)">My Recipes</div>
            <div class="tab" onclick="showTab('activity', event)">Activity</div>
            <div class="tab" onclick="showTab('achievements', event)">Achievements</div>
            <div class="tab" onclick="showTab('favorites', event)">Favorites</div>
        </div>

        <div class="tab-content" id="recipes" style="display: block;">
            <h3>My Recipes</h3>
            <div id="recipeContainer" class="recipe-cards"></div>
        </div>

        <div class="tab-content" id="activity" style="display: none;">
            <h3>Recent Activity</h3>
            <div class="activity-log">
                <div>📝 Created Mediterranean Quinoa Bowl – 2 days ago</div>
                <div>🍜 Cooked Spicy Korean Kimchi Ramen – 3 days ago</div>
                <div>📅 Planned meals for this week – 5 days ago</div>
                <div>❤️ Added Classic Beef Bourguignon to favorites – 1 week ago</div>
            </div>
        </div>

        <div class="tab-content" id="achievements" style="display: none;">
            <h3>Achievements</h3>
            <p>Coming Soon!</p>
        </div>

        <div class="tab-content" id="favorites" style="display: none;">
            <h3>Favorite Recipes</h3>
            <div class="no-fav">
                <p style="font-size: 18px">💔 No Favorites Yet</p>
                <p>Start exploring recipes and add them to your favorites!</p>
                <button onclick="window.location.href='./Recipes.html'">Browse Recipes</button>
            </div>
        </div>
    </main>
    
    <!-- Edit Profile Modal -->
    <div id="editProfileModal" class="modal-overlay">
        <div class="edit-container">
            <h2>Edit Profile</h2>

            <label>Profile Picture</label>
            <input type="file" id="avatarInput" accept="image/*" />
            <img id="previewAvatar" src="https://placehold.co/150x150/CCCCCC/FFFFFF?text=Preview" style="width: 150px; height: 150px; border-radius: 50%; margin: 10px 0; object-fit: cover;" />
        <style>
          #previewAvatar {
            transition: box-shadow 0.4s, transform 0.4s;
            box-shadow: 0 2px 12px #ffd90033;
          }
          #previewAvatar.animated {
            box-shadow: 0 4px 24px #ffb30099;
            transform: scale(1.08) rotate(-2deg);
          }
        </style>

            <label for="nameInput">Name</label>
            <input type="text" id="nameInput" />

            <label for="bioInput">Bio</label>
            <textarea id="bioInput" rows="3" style="resize: vertical; min-height: 50px;"></textarea>

            <label for="locationInput">Location</label>
            <input type="text" id="locationInput" />

            <label for="joinedInput">Join Date</label>
            <input type="date" id="joinedInput" />

            <button onclick="saveProfile()" class="save">Save</button>
            <button onclick="closeEditModal()" class="cancel">Cancel</button>
        </div>
    </div>


    <script>
      document.addEventListener("DOMContentLoaded", function() {
        // --- Navbar Logic ---
        const hamburger = document.querySelector(".hamburger-menu");
        const navLinks = document.querySelector(".nav-links");
        if (hamburger && navLinks) {
          hamburger.addEventListener("click", () => {
            navLinks.classList.toggle("active");
          });
        }
        let nav = document.querySelector("nav");
        if (nav) {
          let lastScrollY = window.scrollY;
          window.addEventListener("scroll", () => {
            if (lastScrollY < window.scrollY && window.scrollY > 100) {
              nav.classList.add("navbar-hidden");
            } else {
              nav.classList.remove("navbar-hidden");
            }
            lastScrollY = window.scrollY;
          });
        }
        const searchInput = document.getElementById("homeSearchInput");
        const resultsDiv = document.getElementById("searchResults");
        if (searchInput && resultsDiv) {
            searchInput.addEventListener("input", function () {
                const query = this.value.trim().toLowerCase();
                if (!query) {
                    resultsDiv.style.display = "none";
                    return;
                }
                const recipes = JSON.parse(localStorage.getItem("recipes") || "[]");
                const matches = recipes.filter(r => r.title.toLowerCase().includes(query));
                resultsDiv.innerHTML = "";
                if (matches.length > 0) {
                    matches.forEach(r => {
                        const div = document.createElement("div");
                        div.textContent = r.title;
                        div.style.padding = "10px";
                        div.style.cursor = "pointer";
                        div.onclick = () => {
                           window.location.href = `Recipes.html?view=${encodeURIComponent(r.title)}`;
                        };
                        resultsDiv.appendChild(div);
                    });
                } else {
                    resultsDiv.innerHTML = '<div style="padding:10px; color:#888;">No matches found</div>';
                }
                resultsDiv.style.display = "block";
            });
            document.addEventListener("click", function (e) {
                if (resultsDiv && !e.target.closest('.nav-search-container')) {
                    resultsDiv.style.display = "none";
                }
            });
        }

        // --- Profile Page Logic ---
        const editProfileModal = document.getElementById('editProfileModal');
        const editProfileBtn = document.getElementById('editProfileBtn');

        editProfileBtn.onclick = () => openEditModal();
        
    window.openEditModal = function() {
      const data = JSON.parse(localStorage.getItem("profileData")) || {};
      document.getElementById("nameInput").value = data.name || "Alex Johnson";
      document.getElementById("bioInput").value = data.bio || "Food enthusiast...";
      document.getElementById("locationInput").value = data.location || "San Francisco, CA";
      document.getElementById("joinedInput").value = data.joinDate || "2024-01-15";
      document.getElementById("previewAvatar").src = data.avatar || "https://placehold.co/150x150/f7c28b/FFFFFF?text=AJ";
      editProfileModal.classList.add('is-open');
      // Disable scrolling and hide scrollbar
      document.body.classList.add('modal-open');
    }

    window.closeEditModal = function() {
      editProfileModal.classList.remove('is-open');
      // Restore scrolling and scrollbar
      document.body.classList.remove('modal-open');
    }
        
        document.getElementById("avatarInput").addEventListener("change", function () {
      if(this.files && this.files[0]) {
        const reader = new FileReader();
        reader.onload = function (e) {
          const avatar = document.getElementById("previewAvatar");
          avatar.src = e.target.result;
          avatar.classList.add("animated");
          setTimeout(() => avatar.classList.remove("animated"), 800);
        };
        reader.readAsDataURL(this.files[0]);
      }
        });

        window.saveProfile = function() {
            const profile = {
                name: document.getElementById("nameInput").value,
                bio: document.getElementById("bioInput").value,
                location: document.getElementById("locationInput").value,
                joinDate: document.getElementById("joinedInput").value,
                avatar: document.getElementById("previewAvatar").src
            };

            localStorage.setItem("profileData", JSON.stringify(profile));
            updateProfileDisplay(profile);
            closeEditModal();
        }
        
        function updateProfileDisplay(data) {
            document.getElementById("profileName").innerText = data.name;
            const bioText = document.getElementById("bioText");
            bioText.innerText = data.bio;
            document.getElementById("locationText").innerText = data.location;
            document.getElementById("joinedText").innerText = data.joinDate;
            const avatarBox = document.getElementById("avatarBox");
            if (data.avatar && !data.avatar.includes('placehold.co')) {
                avatarBox.style.backgroundImage = `url(${data.avatar})`;
                avatarBox.textContent = "";
            } else {
                 avatarBox.style.backgroundImage = ``;
                 avatarBox.textContent = data.name.substring(0,2).toUpperCase();
            }
            // Bio expand/collapse
            const bioBtn = document.getElementById('bioToggleBtn');
            setTimeout(() => {
              if (bioText.scrollHeight > 62) {
                bioBtn.style.display = '';
                bioText.classList.remove('expanded');
                bioBtn.innerText = 'Show more';
              } else {
                bioBtn.style.display = 'none';
              }
            }, 100);
            bioBtn.onclick = function() {
              if (bioText.classList.contains('expanded')) {
                bioText.classList.remove('expanded');
                bioBtn.innerText = 'Show more';
              } else {
                bioText.classList.add('expanded');
                bioBtn.innerText = 'Show less';
              }
            };
        }


        window.showTab = function(tabId, event) {
            const tabs = document.querySelectorAll(".tab");
            const contents = document.querySelectorAll(".tab-content");

            tabs.forEach((tab) => tab.classList.remove("active"));
            contents.forEach((content) => (content.style.display = "none"));

            const contentToShow = document.getElementById(tabId);
            if(contentToShow) contentToShow.style.display = "block";

            if (event && event.currentTarget) {
                event.currentTarget.classList.add("active");
            }

            if (tabId === "recipes") loadRecipesFromLocalStorage();
        }

        function loadRecipesFromLocalStorage() {
            const container = document.getElementById("recipeContainer");
            if (!container) return;

            const recipes = JSON.parse(localStorage.getItem("recipes")) || [];

            if (recipes.length === 0) {
                container.innerHTML = "<p style='text-align:center;'>You haven't created any recipes yet.</p>";
                return;
            }

            container.innerHTML = "";
            recipes.forEach((recipe) => {
                const placeholderImg = `https://placehold.co/300x140/FFE0B2/333333?text=${encodeURIComponent(recipe.title)}`;
                const card = document.createElement("div");
                card.className = "recipe-card";
                card.innerHTML = `
                <img src="${recipe.image || placeholderImg}" alt="${recipe.title}" onerror="this.src='${placeholderImg}'">
                <div class="recipe-info">
                    <h4>${recipe.title}</h4>
                    <p><strong>Time:</strong> ${recipe.cookTime || 'N/A'} min | <strong>Rating:</strong> ${recipe.rating || 'N/A'} ⭐</p>
                </div>
                `;
                container.appendChild(card);
            });
        }
        
        // --- Initial Load ---
        const initialProfileData = JSON.parse(localStorage.getItem("profileData"));
        if (initialProfileData) {
            updateProfileDisplay(initialProfileData);
        }
        showTab('recipes', { currentTarget: document.querySelector('.tab.active') });

      });
    </script>
  </body>
</html>